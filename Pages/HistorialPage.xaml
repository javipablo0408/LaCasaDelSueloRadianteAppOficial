<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LaCasaDelSueloRadianteApp.Pages.HistorialPage"
             Title=""
             BackgroundColor="{StaticResource Gray50}">
    <VerticalStackLayout Padding="20,16,20,0" Spacing="16">
        <Label Text="Historial de Servicios"
               Style="{StaticResource PageTitle}" />

        <!-- Barra de búsqueda -->
        <SearchBar Placeholder="Buscar por nombre, dirección o teléfono"
                   Text="{Binding TextoBusqueda, Mode=TwoWay}"
                   Style="{StaticResource ProfessionalSearchBar}" />

        <!-- Navegación de días -->
        <Frame Style="{StaticResource CardFrame}" Padding="16">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                <Button Grid.Column="0"
                        Text="Anterior" 
                        Style="{StaticResource SecondaryButton}"
                        WidthRequest="100"
                        FontSize="14"
                        Command="{Binding DiaAnteriorCommand}" 
                        IsEnabled="{Binding PuedeRetroceder}" />
                        
                <DatePicker Grid.Column="1"
                            x:Name="FechaPicker"
                            Date="{Binding FechaSeleccionada, Mode=TwoWay}"
                            MinimumDate="{Binding FechaMinima}"
                            MaximumDate="{Binding FechaMaxima}"
                            HorizontalOptions="Center"
                            FontSize="16" />
                            
                <Button Grid.Column="2"
                        Text="Siguiente" 
                        Style="{StaticResource SecondaryButton}"
                        WidthRequest="100"
                        FontSize="14"
                        Command="{Binding DiaSiguienteCommand}" 
                        IsEnabled="{Binding PuedeAvanzar}" />
            </Grid>
        </Frame>

        <!-- Indicador de carga -->
        <ActivityIndicator IsVisible="{Binding EstaCargando}" 
                          IsRunning="{Binding EstaCargando}"
                          Color="{StaticResource Primary}"
                          HeightRequest="40"
                          VerticalOptions="Center" />

        <!-- Mensaje cuando no hay datos -->
        

        <CollectionView x:Name="ServiciosCollectionView"
                        ItemsSource="{Binding ServiciosFiltrados}"
                        SelectionMode="Single"
                        SelectionChanged="ServiciosCollectionView_SelectionChanged"
                        IsVisible="{Binding NoEstaCargando}"
                        Margin="0,0,0,16">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Style="{StaticResource CardFrame}" Margin="0,4,0,8">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="{Binding NombreCliente}" 
                                   FontAttributes="Bold" 
                                   FontSize="18"
                                   TextColor="{StaticResource Gray900}"/>
                            <Label Text="{Binding Direccion}" 
                                   Style="{StaticResource BodyText}" />
                            <Label Text="{Binding Telefono}" 
                                   Style="{StaticResource BodyText}" />
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>