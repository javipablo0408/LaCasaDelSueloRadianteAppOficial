<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=netstandard"
             xmlns:converters="clr-namespace:LaCasaDelSueloRadianteApp.Converters"
             x:Class="LaCasaDelSueloRadianteApp.AgregarPage"
             Title=""
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Padding="16" Spacing="20" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand">

            <!-- Header -->
            <Label Text="Nuevo Servicio" 
                   Style="{StaticResource PageTitle}"
                   HorizontalOptions="Center"
                   Margin="0,10,0,20" />

            <!-- Cliente Section -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Información del Cliente" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="NombreEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Nombre del cliente" 
                                   Unfocused="OnNombreEntryUnfocused" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="i" 
                                    Clicked="OnInfoNombreClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="DireccionEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Dirección" 
                                   Unfocused="OnDireccionEntryUnfocused" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="i" 
                                    Clicked="OnInfoDireccionClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="EmailEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Email" 
                                   Keyboard="Email" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="i" 
                                    Clicked="OnInfoEmailClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="TelefonoEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Teléfono" 
                                   Keyboard="Telephone" 
                                   Unfocused="OnTelefonoEntryUnfocused" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="i" 
                                    Clicked="OnInfoTelefonoClicked" />
                        </Grid>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Instalación Section -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Instalación" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Picker x:Name="TipoServicioPicker" 
                                    Style="{StaticResource FormEntry}" 
                                    Title="Tipo de servicio" 
                                    SelectedIndexChanged="OnTipoServicioPickerChanged" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoTipoServicioClicked" />
                        </Grid>
                        
                        <Entry x:Name="TipoServicioOtroEntry" 
                               Style="{StaticResource FormEntry}" 
                               Placeholder="Especifica otro servicio" 
                               IsVisible="False" />
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Picker x:Name="TipoInstalacionPicker" 
                                    Style="{StaticResource FormEntry}" 
                                    Title="Tipo de instalación" 
                                    SelectedIndexChanged="OnTipoInstalacionPickerChanged" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoTipoInstalacionClicked" />
                        </Grid>
                        
                        <Entry x:Name="TipoInstalacionOtroEntry" 
                               Style="{StaticResource FormEntry}" 
                               Placeholder="Especifica otra instalación" 
                               IsVisible="False" />
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Picker x:Name="FuenteCalorPicker" 
                                    Style="{StaticResource FormEntry}" 
                                    Title="Fuente de calor" 
                                    SelectedIndexChanged="OnFuenteCalorPickerChanged" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoFuenteCalorClicked" />
                        </Grid>
                        
                        <Entry x:Name="FuenteCalorOtroEntry" 
                               Style="{StaticResource FormEntry}" 
                               Placeholder="Especifica otra fuente de calor" 
                               IsVisible="False" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Datos adicionales de la instalación -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Datos Adicionales de la Instalación" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="AntiguedadInstalacionEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Antigüedad de la instalación (años)" 
                                   Keyboard="Numeric" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoAntiguedadInstalacionClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="AntiguedadAparatoProduccionEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Antigüedad del aparato de producción (años)" 
                                   Keyboard="Numeric" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoAntiguedadAparatoClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="MarcaEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Marca del aparato de producción" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoMarcaClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="ModeloEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Modelo del aparato de producción" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoModeloClicked" />
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Entry x:Name="UltimaRevisionEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Última revisión (años)" 
                                   Keyboard="Numeric" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoUltimaRevisionClicked" />
                        </Grid>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Próxima Visita y Equipamiento -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Configuración del Servicio" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="Próxima visita" 
                                   Style="{StaticResource BodyText}" 
                                   VerticalOptions="Center" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoProximaVisitaClicked" />
                        </Grid>
                        
                        <Picker x:Name="ProximaVisitaPicker" 
                                Style="{StaticResource FormEntry}" 
                                Title="Selecciona meses para la próxima visita">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>6 meses</x:String>
                                    <x:String>12 meses</x:String>
                                    <x:String>24 meses</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="Equipamiento utilizado" 
                                   Style="{StaticResource BodyText}" 
                                   VerticalOptions="Center" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoEquipamientoClicked" />
                        </Grid>
                        
                        <Picker x:Name="EquipamientoPicker" 
                                Style="{StaticResource FormEntry}" 
                                Title="Selecciona equipamiento">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>maquina de impulsos + desenlodadora</x:String>
                                    <x:String>maquina desenlodadora</x:String>
                                    <x:String>maquina de impulsos</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Fotos de instalación -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Fotos de Instalación" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <Button Text="Adjuntar Fotos de Instalación" 
                            Style="{StaticResource SecondaryButton}" 
                            Clicked="OnAdjuntarFotosInstalacionClicked" />
                </StackLayout>
            </Frame>

            <!-- Valores de la Instalación -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Valores de la Instalación"
                           Style="{StaticResource SectionTitle}" />

                    <StackLayout Spacing="16">
                        <!-- pH -->
                        <StackLayout Spacing="8">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Label Text="pH" 
                                       Style="{StaticResource BodyText}" 
                                       FontAttributes="Bold" 
                                       VerticalOptions="Center" />
                                <Button Grid.Column="1" 
                                        Style="{StaticResource InfoButton}" 
                                        Text="ℹ️" 
                                        Clicked="OnInfoPhClicked" />
                            </Grid>
                            
                            <Entry x:Name="PhEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="pH" 
                                   Keyboard="Numeric" />
                            
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Button Text="Adjuntar Foto pH" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnAdjuntarPhFotoClicked" />
                                <Button Text="Eliminar Foto" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnEliminarPhFotoClicked" />
                            </StackLayout>
                        </StackLayout>

                        <!-- Conductividad -->
                        <StackLayout Spacing="8">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Label Text="Conductividad" 
                                       Style="{StaticResource BodyText}" 
                                       FontAttributes="Bold" 
                                       VerticalOptions="Center" />
                                <Button Grid.Column="1" 
                                        Style="{StaticResource InfoButton}" 
                                        Text="ℹ️" 
                                        Clicked="OnInfoConductividadClicked" />
                            </Grid>
                            
                            <Entry x:Name="ConductividadEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Conductividad" 
                                   Keyboard="Numeric" />
                            
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Button Text="Adjuntar Foto Conductividad" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnAdjuntarConductividadFotoClicked" />
                                <Button Text="Eliminar Foto" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnEliminarConductividadFotoClicked" />
                            </StackLayout>
                        </StackLayout>

                        <!-- Concentración inhibidor -->
                        <StackLayout Spacing="8">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Label Text="Concentración Inhibidor" 
                                       Style="{StaticResource BodyText}" 
                                       FontAttributes="Bold" 
                                       VerticalOptions="Center" />
                                <Button Grid.Column="1" 
                                        Style="{StaticResource InfoButton}" 
                                        Text="ℹ️" 
                                        Clicked="OnInfoConcentracionClicked" />
                            </Grid>
                            
                            <Entry x:Name="ConcentracionInhibidorEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Concentración inhibidor" 
                                   Keyboard="Numeric" />
                            
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Button Text="Adjuntar Foto Concentración" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnAdjuntarConcentracionFotoClicked" />
                                <Button Text="Eliminar Foto" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnEliminarConcentracionFotoClicked" />
                            </StackLayout>
                        </StackLayout>

                        <!-- Turbidez -->
                        <StackLayout Spacing="8">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Label Text="Turbidez" 
                                       Style="{StaticResource BodyText}" 
                                       FontAttributes="Bold" 
                                       VerticalOptions="Center" />
                                <Button Grid.Column="1" 
                                        Style="{StaticResource InfoButton}" 
                                        Text="ℹ️" 
                                        Clicked="OnInfoTurbidezClicked" />
                            </Grid>
                            
                            <Picker x:Name="TurbidezPicker"
                                    Style="{StaticResource FormEntry}"
                                    Title="Selecciona turbidez"
                                    SelectedIndexChanged="OnTurbidezPickerChanged">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>Óptimo</x:String>
                                        <x:String>Ligeramente turbio</x:String>
                                        <x:String>Medio turbio</x:String>
                                        <x:String>Muy enlodado</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                            
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Button Text="Adjuntar Foto Turbidez" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnAdjuntarTurbidezFotoClicked" />
                                <Button Text="Eliminar Foto" 
                                        Style="{StaticResource OutlineButton}" 
                                        Clicked="OnEliminarTurbidezFotoClicked" />
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Comentarios -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Comentarios" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="Comentarios Generales" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" 
                                   VerticalOptions="Center" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoComentariosClicked" />
                        </Grid>
                        
                        <Editor x:Name="ComentariosEntry" 
                                Style="{StaticResource FormEntry}" 
                                Placeholder="Comentarios generales" 
                                AutoSize="TextChanges" 
                                MinimumHeightRequest="80" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="Comentarios del Instalador" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" 
                                   VerticalOptions="Center" />
                            <Button Grid.Column="1" 
                                    Style="{StaticResource InfoButton}" 
                                    Text="ℹ️" 
                                    Clicked="OnInfoComentariosInstaladorClicked" />
                        </Grid>
                        
                        <Editor x:Name="ComentariosInstaladorEntry" 
                                Style="{StaticResource FormEntry}" 
                                Placeholder="Comentarios del instalador" 
                                AutoSize="TextChanges" 
                                MinimumHeightRequest="80" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Productos utilizados -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <Label Text="Productos Utilizados" 
                               Style="{StaticResource SectionTitle}" 
                               VerticalOptions="Center" />
                        <Button Grid.Column="1" 
                                Style="{StaticResource InfoButton}" 
                                Text="ℹ️" 
                                Clicked="OnInfoProductosUtilizadosClicked" />
                    </Grid>

                    <StackLayout Spacing="16">
                        <!-- Inhibidores -->
                        <StackLayout Spacing="8">
                            <Label Text="Inhibidores" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" />
                            
                            <Grid ColumnDefinitions="2*,1*" ColumnSpacing="12">
                                <Picker x:Name="InhibidorPicker" 
                                        Style="{StaticResource FormEntry}" 
                                        Title="Selecciona inhibidor" 
                                        SelectedIndexChanged="OnInhibidorPickerChanged">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Floixem I</x:String>
                                            <x:String>Fernox F1</x:String>
                                            <x:String>X100</x:String>
                                            <x:String>Otro</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                                
                                <Entry x:Name="InhibidorCantidadEntry" 
                                       Grid.Column="1" 
                                       Style="{StaticResource FormEntry}" 
                                       Placeholder="Cantidad" 
                                       Keyboard="Numeric" />
                            </Grid>
                            
                            <Entry x:Name="InhibidorOtroEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Especifica otro inhibidor" 
                                   IsVisible="False" />
                        </StackLayout>

                        <!-- Limpiadores -->
                        <StackLayout Spacing="8">
                            <Label Text="Limpiadores" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" />
                            
                            <Grid ColumnDefinitions="2*,1*" ColumnSpacing="12">
                                <Picker x:Name="LimpiadorPicker" 
                                        Style="{StaticResource FormEntry}" 
                                        Title="Selecciona limpiador" 
                                        SelectedIndexChanged="OnLimpiadorPickerChanged">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Kamko Hyper-Flush</x:String>
                                            <x:String>Floixem C</x:String>
                                            <x:String>X800</x:String>
                                            <x:String>F8</x:String>
                                            <x:String>Calsanit</x:String>
                                            <x:String>Otro</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                                
                                <Entry x:Name="LimpiadorCantidadEntry" 
                                       Grid.Column="1" 
                                       Style="{StaticResource FormEntry}" 
                                       Placeholder="Cantidad" 
                                       Keyboard="Numeric" />
                            </Grid>
                            
                            <Entry x:Name="LimpiadorOtroEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Especifica otro limpiador" 
                                   IsVisible="False" />
                        </StackLayout>

                        <!-- Biocidas -->
                        <StackLayout Spacing="8">
                            <Label Text="Biocidas" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" />
                            
                            <Grid ColumnDefinitions="2*,1*" ColumnSpacing="12">
                                <Picker x:Name="BiocidaPicker" 
                                        Style="{StaticResource FormEntry}" 
                                        Title="Selecciona biocida" 
                                        SelectedIndexChanged="OnBiocidaPickerChanged">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Floixem B</x:String>
                                            <x:String>Fernox F7</x:String>
                                            <x:String>X700</x:String>
                                            <x:String>Kamko Bio</x:String>
                                            <x:String>Otro</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                                
                                <Entry x:Name="BiocidaCantidadEntry" 
                                       Grid.Column="1" 
                                       Style="{StaticResource FormEntry}" 
                                       Placeholder="Cantidad" 
                                       Keyboard="Numeric" />
                            </Grid>
                            
                            <Entry x:Name="BiocidaOtroEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Especifica otro biocida" 
                                   IsVisible="False" />
                        </StackLayout>

                        <!-- Anticongelantes -->
                        <StackLayout Spacing="8">
                            <Label Text="Anticongelantes" 
                                   Style="{StaticResource BodyText}" 
                                   FontAttributes="Bold" />
                            
                            <Grid ColumnDefinitions="2*,1*" ColumnSpacing="12">
                                <Picker x:Name="AnticongelantePicker" 
                                        Style="{StaticResource FormEntry}" 
                                        Title="Selecciona anticongelante" 
                                        SelectedIndexChanged="OnAnticongelantePickerChanged">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Floixem</x:String>
                                            <x:String>Fernox</x:String>
                                            <x:String>Otro</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                                
                                <Entry x:Name="AnticongelanteCantidadEntry" 
                                       Grid.Column="1" 
                                       Style="{StaticResource FormEntry}" 
                                       Placeholder="Cantidad" 
                                       Keyboard="Numeric" />
                            </Grid>
                            
                            <Entry x:Name="AnticongelanteOtroEntry" 
                                   Style="{StaticResource FormEntry}" 
                                   Placeholder="Especifica otro anticongelante" 
                                   IsVisible="False" />
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Vista previa de imágenes -->
            <Frame Style="{StaticResource CardFrame}">
                <StackLayout Spacing="16">
                    <Label Text="Vista Previa de Imágenes Adjuntas" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <CollectionView x:Name="ImagenesPreviewCollection"
                                    ItemsSource="{Binding ImagenesAdjuntas}"
                                    ItemsLayout="HorizontalList"
                                    HeightRequest="120">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Style="{StaticResource CardFrame}" 
                                       Margin="4" 
                                       Padding="8">
                                    <StackLayout Spacing="8">
                                        <Image Source="{Binding .}" 
                                               Aspect="AspectFill" 
                                               HeightRequest="80" 
                                               WidthRequest="80"
                                               HorizontalOptions="Center" />
                                        <Button Text="Eliminar"
                                                Style="{StaticResource OutlineButton}"
                                                Clicked="OnEliminarFotoInstalacionClicked"
                                                BindingContext="{Binding .}"
                                                FontSize="12" />
                                    </StackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Indicador de guardado -->
            <ActivityIndicator IsRunning="{Binding IsGuardando}" 
                               IsVisible="{Binding IsGuardando}" 
                               Color="{StaticResource Primary}" 
                               HeightRequest="40" 
                               HorizontalOptions="Center" />

            <!-- Botones de acción -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="16" Margin="0,10,0,20">
                <Button Text="Guardar Servicio"
                        Style="{StaticResource PrimaryButton}"
                        Clicked="OnGuardarClicked"
                        IsEnabled="{Binding IsGuardando, Converter={StaticResource InverseBoolConverter}}"
                        Grid.Column="0" />
                        
                <Button Text="Resetear Formulario"
                        Style="{StaticResource SecondaryButton}"
                        Clicked="OnResetClicked"
                        Grid.Column="1" />
            </Grid>

        </StackLayout>
    </ScrollView>
</ContentPage>
